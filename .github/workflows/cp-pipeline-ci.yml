name: Course Production Pipeline CI

on:
  push:
    branches:
      - "*"

permissions:
  contents: read # for checkout

jobs:
  dagger-for-infrasctructure-documentation:
    name: Dagger for Infrastructure Documentation
    runs-on: ubuntu-latest
    permissions:
      contents: write # to be able to publish a GitHub release
      issues: write # to be able to comment on released issues
      pull-requests: write # to be able to comment on released pull requests
      id-token: write # to enable use of OIDC for npm provenance
      packages: write # to be able to publish a GitHub package
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      # - name: Login to GitHub Container Registry
      #   uses: docker/login-action@v3
      #   with:
      #     registry: ghcr.io
      #     username: ${{ github.actor }}
      #     password: ${{ secrets.GITHUB_TOKEN }}
      - name: Debug GITHUB_TOKEN permissions
        run: gh auth status
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      # - name: Build and push the image
      #   run: |
      #     docker build . --tag ghcr.io/bcit-ltc/${{ github.event.repository.name }}:testit
      #     docker push ghcr.io/bcit-ltc/${{ github.event.repository.name }}:testit

      - name: Run Dagger
        uses: dagger/dagger-for-github@8.0.0
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        with:
          cloud-token: ${{ secrets.DAGGER_CLOUD_TOKEN }}
          call: publish --token=env://GITHUB_TOKEN --branch=${{ github.ref_name }}
          # args: semanticrelease
          
